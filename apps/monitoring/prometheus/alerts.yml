groups:
  - name: blog_observability
    interval: 30s
    rules:
      - alert: BlackboxProbeFailed
        expr: probe_success{job="blackbox_http"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Blackbox probe failed"
          description: "Probe is failing for {{ $labels.instance }} (job={{ $labels.job }})"

      - alert: MetricsApiDown
        expr: up{job="web_metrics"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "metrics-api is down"
          description: "Prometheus cannot scrape metrics-api ({{ $labels.instance }})"

      - alert: NginxExporterDown
        expr: up{job="nginx"} == 0
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "nginx exporter is down"
          description: "Prometheus cannot scrape nginx exporter ({{ $labels.instance }})"

      - alert: NodeExporterDown
        expr: up{job="node"} == 0
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "node exporter is down"
          description: "Prometheus cannot scrape node exporter ({{ $labels.instance }})"

      - alert: NoBlogClientMetricsIngested
        expr: increase(web_page_visits_total{site="blog.entazis.dev"}[30m]) == 0
        for: 30m
        labels:
          severity: warning
        annotations:
          summary: "No blog client metrics in last 30m"
          description: "No web_page_visits_total has been ingested for blog.entazis.dev in the last 30 minutes."
